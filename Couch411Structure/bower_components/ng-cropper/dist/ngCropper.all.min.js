!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return"undefined"==typeof t}function h(t,e){var h=[];return i(e)&&h.push(e),h.slice.apply(t,h)}function o(t,i){var e=h(arguments,2);return function(){return t.apply(i,e.concat(h(arguments)))}}function n(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==g.protocol||i[2]!==g.hostname||i[3]!==g.port)}function a(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function s(t){return t?"rotate("+t+"deg)":"none"}function r(t,i){var e,h,o=U(t.degree)%180,n=(o>90?180-o:o)*Math.PI/180,a=q(n),s=S(n),r=t.width,d=t.height,p=t.aspectRatio;return i?(e=r/(s+a/p),h=e/p):(e=r*s+d*a,h=r*a+d*s),{width:e,height:h}}function d(i,e){var h=t("<canvas>")[0],o=h.getContext("2d"),n=e.naturalWidth,a=e.naturalHeight,s=e.rotate,d=r({width:n,height:a,degree:s});return s?(h.width=d.width,h.height=d.height,o.save(),o.translate(d.width/2,d.height/2),o.rotate(s*Math.PI/180),o.drawImage(i,-n/2,-a/2,n,a),o.restore()):(h.width=n,h.height=a,o.drawImage(i,0,0,n,a)),h}function p(i,e){this.$element=t(i),this.options=t.extend({},p.DEFAULTS,t.isPlainObject(e)&&e),this.ready=!1,this.built=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.canvas=null,this.cropBox=null,this.load()}var l=t(window),c=t(document),g=window.location,u=".cropper",f="preview"+u,m=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,v="cropper-modal",w="cropper-hide",x="cropper-hidden",b="cropper-invisible",C="cropper-move",y="cropper-crop",B="cropper-disabled",$="cropper-bg",D="mousedown touchstart",T="mousemove touchmove",W="mouseup mouseleave touchend touchleave touchcancel",L="wheel mousewheel DOMMouseScroll",H="dblclick",k="resize"+u,z="build"+u,R="built"+u,E="dragstart"+u,Y="dragmove"+u,X="dragend"+u,M="zoomin"+u,F="zoomout"+u,P="change"+u,I=t.isFunction(t("<canvas>")[0].getContext),O=Math.sqrt,A=Math.min,j=Math.max,U=Math.abs,q=Math.sin,S=Math.cos,Z=parseFloat,_={};_.load=function(i){var e,h,o,s,r=this.options,d=this.$element;if(!i)if(d.is("img")){if(!d.attr("src"))return;i=d.prop("src")}else d.is("canvas")&&I&&(i=d[0].toDataURL());i&&(o=t.Event(z),d.one(z,r.build).trigger(o),o.isDefaultPrevented()||(r.checkImageOrigin&&n(i)&&(e=' crossOrigin="anonymous"',d.prop("crossOrigin")||(h=a(i))),this.$clone=s=t("<img"+(e||"")+' src="'+(h||i)+'">'),s.one("load",t.proxy(function(){var t=s[0],e=t.naturalWidth||t.width,h=t.naturalHeight||t.height;this.image={naturalWidth:e,naturalHeight:h,aspectRatio:e/h,rotate:0},this.url=i,this.ready=!0,this.build()},this)).one("error",function(){s.remove()}),s.addClass(w).insertAfter(d)))},_.build=function(){var i,e,h,o=this.$element,n=this.$clone,a=this.options;this.ready&&(this.built&&this.unbuild(),this.$cropper=i=t(p.TEMPLATE),o.addClass(x),n.removeClass(w),this.$container=o.parent().append(i),this.$canvas=i.find(".cropper-canvas").append(n),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=h=e.find(".cropper-face"),this.addListeners(),this.initPreview(),a.aspectRatio=Z(a.aspectRatio)||0/0,a.autoCrop?(this.cropped=!0,a.modal&&this.$dragBox.addClass(v)):e.addClass(x),a.background&&i.addClass($),a.highlight||h.addClass(b),a.guides||e.find(".cropper-dashed").addClass(x),a.cropBoxMovable&&h.addClass(C).data("drag","all"),a.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(x),this.setDragMode(a.dragCrop?"crop":a.movable?"move":"none"),this.built=!0,this.render(),this.setData(a.data),o.one(R,a.built).trigger(R))},_.unbuild=function(){this.built&&(this.built=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.removeListeners(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},t.extend(_,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.$element,i=this.$container,e=this.$cropper,h=this.options;e.addClass(x),t.removeClass(x),e.css(this.container={width:j(i.width(),Z(h.minContainerWidth)||200),height:j(i.height(),Z(h.minContainerHeight)||100)}),t.addClass(x),e.removeClass(x)},initCanvas:function(){var i=this.container,e=i.width,h=i.height,o=this.image,n=o.aspectRatio,a={aspectRatio:n,width:e,height:h};h*n>e?a.height=e/n:a.width=h*n,a.oldLeft=a.left=(e-a.width)/2,a.oldTop=a.top=(h-a.height)/2,this.canvas=a,this.limitCanvas(!0,!0),this.initialImage=t.extend({},o),this.initialCanvas=t.extend({},a)},limitCanvas:function(i,e){var h,o,n=this.options,a=n.strict,s=this.container,r=s.width,d=s.height,p=this.canvas,l=p.aspectRatio,c=this.cropBox,g=this.cropped&&c,u=this.initialCanvas||p,f=u.width,m=u.height;i&&(h=Z(n.minCanvasWidth)||0,o=Z(n.minCanvasHeight)||0,h?(a&&(h=j(g?c.width:f,h)),o=h/l):o?(a&&(o=j(g?c.height:m,o)),h=o*l):a&&(g?(h=c.width,o=c.height,o*l>h?h=o*l:o=h/l):(h=f,o=m)),t.extend(p,{minWidth:h,minHeight:o,maxWidth:1/0,maxHeight:1/0})),e&&(a?g?(p.minLeft=A(c.left,c.left+c.width-p.width),p.minTop=A(c.top,c.top+c.height-p.height),p.maxLeft=c.left,p.maxTop=c.top):(p.minLeft=A(0,r-p.width),p.minTop=A(0,d-p.height),p.maxLeft=j(0,r-p.width),p.maxTop=j(0,d-p.height)):(p.minLeft=-p.width,p.minTop=-p.height,p.maxLeft=r,p.maxTop=d))},renderCanvas:function(t){var i,e,h=this.options,o=this.canvas,n=this.image;this.rotated&&(this.rotated=!1,e=r({width:n.width,height:n.height,degree:n.rotate}),i=e.width/e.height,i!==o.aspectRatio&&(o.left-=(e.width-o.width)/2,o.top-=(e.height-o.height)/2,o.width=e.width,o.height=e.height,o.aspectRatio=i,this.limitCanvas(!0,!1))),(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=A(j(o.width,o.minWidth),o.maxWidth),o.height=A(j(o.height,o.minHeight),o.maxHeight),this.limitCanvas(!1,!0),o.oldLeft=o.left=A(j(o.left,o.minLeft),o.maxLeft),o.oldTop=o.top=A(j(o.top,o.minTop),o.maxTop),this.$canvas.css({width:o.width,height:o.height,left:o.left,top:o.top}),this.renderImage(),this.cropped&&h.strict&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(){var i,e=this.canvas,h=this.image;h.rotate&&(i=r({width:e.width,height:e.height,degree:h.rotate,aspectRatio:h.aspectRatio},!0)),t.extend(h,i?{width:i.width,height:i.height,left:(e.width-i.width)/2,top:(e.height-i.height)/2}:{width:e.width,height:e.height,left:0,top:0}),this.$clone.css({width:h.width,height:h.height,marginLeft:h.left,marginTop:h.top,transform:s(h.rotate)})},initCropBox:function(){var i=this.options,e=this.canvas,h=i.aspectRatio,o=Z(i.autoCropArea)||.8,n={width:e.width,height:e.height};h&&(e.height*h>e.width?n.height=n.width/h:n.width=n.height*h),this.cropBox=n,this.limitCropBox(!0,!0),n.width=A(j(n.width,n.minWidth),n.maxWidth),n.height=A(j(n.height,n.minHeight),n.maxHeight),n.width=j(n.minWidth,n.width*o),n.height=j(n.minHeight,n.height*o),n.oldLeft=n.left=e.left+(e.width-n.width)/2,n.oldTop=n.top=e.top+(e.height-n.height)/2,this.initialCropBox=t.extend({},n)},limitCropBox:function(t,i){var e,h,o=this.options,n=o.strict,a=this.container,s=a.width,r=a.height,d=this.canvas,p=this.cropBox,l=o.aspectRatio;t&&(e=Z(o.minCropBoxWidth)||0,h=Z(o.minCropBoxHeight)||0,p.minWidth=A(s,e),p.minHeight=A(r,h),p.maxWidth=A(s,n?d.width:s),p.maxHeight=A(r,n?d.height:r),l&&(p.maxHeight*l>p.maxWidth?(p.minHeight=p.minWidth/l,p.maxHeight=p.maxWidth/l):(p.minWidth=p.minHeight*l,p.maxWidth=p.maxHeight*l)),p.minWidth=A(p.maxWidth,p.minWidth),p.minHeight=A(p.maxHeight,p.minHeight)),i&&(n?(p.minLeft=j(0,d.left),p.minTop=j(0,d.top),p.maxLeft=A(s,d.left+d.width)-p.width,p.maxTop=A(r,d.top+d.height)-p.height):(p.minLeft=0,p.minTop=0,p.maxLeft=s-p.width,p.maxTop=r-p.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,h=i.height,o=this.cropBox;(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=A(j(o.width,o.minWidth),o.maxWidth),o.height=A(j(o.height,o.minHeight),o.maxHeight),this.limitCropBox(!1,!0),o.oldLeft=o.left=A(j(o.left,o.minLeft),o.maxLeft),o.oldTop=o.top=A(j(o.top,o.minTop),o.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data("drag",o.width===e&&o.height===h?"move":"all"),this.$cropBox.css({width:o.width,height:o.height,left:o.left,top:o.top}),this.cropped&&t.strict&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){var t=this.options,i=this.$element;this.preview(),t.crop&&t.crop.call(i,this.getData()),i.trigger(P)}}),_.initPreview=function(){var i=this.url;this.$preview=t(this.options.preview),this.$viewBox.html('<img src="'+i+'">'),this.$preview.each(function(){var e=t(this);e.data(f,{width:e.width(),height:e.height(),original:e.html()}).html('<img src="'+i+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation: 0deg!important">')})},_.resetPreview=function(){this.$preview.each(function(){var i=t(this);i.html(i.data(f).original).removeData(f)})},_.preview=function(){var i=this.image,e=this.canvas,h=this.cropBox,o=i.width,n=i.height,a=h.left-e.left-i.left,r=h.top-e.top-i.top,d=i.rotate;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:o,height:n,marginLeft:-a,marginTop:-r,transform:s(d)}),this.$preview.each(function(){var i=t(this),e=i.data(f),p=e.width/h.width,l=e.width,c=h.height*p;c>e.height&&(p=e.height/h.height,l=h.width*p,c=e.height),i.width(l).height(c).find("img").css({width:o*p,height:n*p,marginLeft:-a*p,marginTop:-r*p,transform:s(d)})}))},_.addListeners=function(){var i=this.options,e=this.$element,h=this.$cropper;t.isFunction(i.dragstart)&&e.on(E,i.dragstart),t.isFunction(i.dragmove)&&e.on(Y,i.dragmove),t.isFunction(i.dragend)&&e.on(X,i.dragend),t.isFunction(i.zoomin)&&e.on(M,i.zoomin),t.isFunction(i.zoomout)&&e.on(F,i.zoomout),t.isFunction(i.change)&&e.on(P,i.change),h.on(D,t.proxy(this.dragstart,this)),i.zoomable&&i.mouseWheelZoom&&h.on(L,t.proxy(this.wheel,this)),i.doubleClickToggle&&h.on(H,t.proxy(this.dblclick,this)),c.on(T,this._dragmove=o(this.dragmove,this)).on(W,this._dragend=o(this.dragend,this)),i.responsive&&l.on(k,this._resize=o(this.resize,this))},_.removeListeners=function(){var i=this.options,e=this.$element,h=this.$cropper;t.isFunction(i.dragstart)&&e.off(E,i.dragstart),t.isFunction(i.dragmove)&&e.off(Y,i.dragmove),t.isFunction(i.dragend)&&e.off(X,i.dragend),t.isFunction(i.zoomin)&&e.off(M,i.zoomin),t.isFunction(i.zoomout)&&e.off(F,i.zoomout),t.isFunction(i.change)&&e.off(P,i.change),h.off(D,this.dragstart),i.zoomable&&i.mouseWheelZoom&&h.off(L,this.wheel),i.doubleClickToggle&&h.off(H,this.dblclick),c.off(T,this._dragmove).off(W,this._dragend),i.responsive&&l.off(k,this._resize)},t.extend(_,{resize:function(){var i,e,h,o=this.$container,n=this.container;!this.disabled&&n&&(h=o.width()/n.width,(1!==h||o.height()!==n.height)&&(i=this.getCanvasData(),e=this.getCropBoxData(),this.render(),this.setCanvasData(t.each(i,function(t,e){i[t]=e*h})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*h}))))},dblclick:function(){this.disabled||this.setDragMode(this.$dragBox.hasClass(y)?"move":"crop")},wheel:function(t){var i=t.originalEvent,e=1;this.disabled||(t.preventDefault(),i.deltaY?e=i.deltaY>0?1:-1:i.wheelDelta?e=-i.wheelDelta/120:i.detail&&(e=i.detail>0?1:-1),this.zoom(.1*-e))},dragstart:function(i){var e,h,o,n=this.options,a=i.originalEvent,s=a&&a.touches,r=i;if(!this.disabled){if(s){if(o=s.length,o>1){if(!n.zoomable||!n.touchDragZoom||2!==o)return;r=s[1],this.startX2=r.pageX,this.startY2=r.pageY,e="zoom"}r=s[0]}if(e=e||t(r.target).data("drag"),m.test(e)){if(i.preventDefault(),h=t.Event(E,{originalEvent:a,dragType:e}),this.$element.trigger(h),h.isDefaultPrevented())return;this.dragType=e,this.cropping=!1,this.startX=r.pageX,this.startY=r.pageY,"crop"===e&&(this.cropping=!0,this.$dragBox.addClass(v))}}},dragmove:function(i){var e,h,o=this.options,n=i.originalEvent,a=n&&n.touches,s=i,r=this.dragType;if(!this.disabled){if(a){if(h=a.length,h>1){if(!o.zoomable||!o.touchDragZoom||2!==h)return;s=a[1],this.endX2=s.pageX,this.endY2=s.pageY}s=a[0]}if(r){if(i.preventDefault(),e=t.Event(Y,{originalEvent:n,dragType:r}),this.$element.trigger(e),e.isDefaultPrevented())return;this.endX=s.pageX,this.endY=s.pageY,this.change(s.shiftKey)}}},dragend:function(i){var e,h=this.dragType;if(!this.disabled&&h){if(i.preventDefault(),e=t.Event(X,{originalEvent:i.originalEvent,dragType:h}),this.$element.trigger(e),e.isDefaultPrevented())return;this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(v,this.cropped&&this.options.modal)),this.dragType=""}}}),t.extend(_,{crop:function(){this.built&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(v),this.$cropBox.removeClass(x)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.built&&!this.disabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(),this.renderCanvas(),this.$dragBox.removeClass(v),this.$cropBox.addClass(x))},destroy:function(){var t=this.$element;this.ready?(this.unbuild(),t.removeClass(x)):this.$clone&&this.$clone.remove(),t.removeData("cropper")},replace:function(t){!this.disabled&&t&&(this.options.data=null,this.load(t))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(B))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(B))},move:function(t,e){var h=this.canvas;this.built&&!this.disabled&&this.options.movable&&i(t)&&i(e)&&(h.left+=t,h.top+=e,this.renderCanvas(!0))},zoom:function(i){var e,h,o,n=this.canvas;if(i=Z(i),i&&this.built&&!this.disabled&&this.options.zoomable){if(e=t.Event(i>0?M:F),this.$element.trigger(e),e.isDefaultPrevented())return;i=-1>=i?1/(1-i):1>=i?1+i:i,h=n.width*i,o=n.height*i,n.left-=(h-n.width)/2,n.top-=(o-n.height)/2,n.width=h,n.height=o,this.renderCanvas(!0),this.setDragMode("move")}},rotate:function(t){var i=this.image;t=Z(t),t&&this.built&&!this.disabled&&this.options.rotatable&&(i.rotate=(i.rotate+t)%360,this.rotated=!0,this.renderCanvas(!0))},getData:function(i){var e,h,o=this.cropBox,n=this.canvas,a=this.image;return this.built&&this.cropped?(h={x:o.left-n.left,y:o.top-n.top,width:o.width,height:o.height},e=a.width/a.naturalWidth,t.each(h,function(t,o){o/=e,h[t]=i?Math.round(o):o})):h={x:0,y:0,width:0,height:0},h.rotate=this.ready?a.rotate:0,h},setData:function(e){var h,o=this.image,n=this.canvas,a={};this.built&&!this.disabled&&t.isPlainObject(e)&&(i(e.rotate)&&e.rotate!==o.rotate&&this.options.rotatable&&(o.rotate=e.rotate,this.rotated=!0,this.renderCanvas(!0)),h=o.width/o.naturalWidth,i(e.x)&&(a.left=e.x*h+n.left),i(e.y)&&(a.top=e.y*h+n.top),i(e.width)&&(a.width=e.width*h),i(e.height)&&(a.height=e.height*h),this.setCropBoxData(a))},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var t,i=this.canvas;return this.built&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCanvasData:function(e){var h=this.canvas,o=h.aspectRatio;this.built&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(h.left=e.left),i(e.top)&&(h.top=e.top),i(e.width)?(h.width=e.width,h.height=e.width/o):i(e.height)&&(h.height=e.height,h.width=e.height*o),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.built&&this.cropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var h=this.cropBox,o=this.options.aspectRatio;this.built&&this.cropped&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(h.left=e.left),i(e.top)&&(h.top=e.top),i(e.width)&&(h.width=e.width),i(e.height)&&(h.height=e.height),o&&(i(e.width)?h.height=h.width/o:i(e.height)&&(h.width=h.height*o)),this.renderCropBox())},getCroppedCanvas:function(i){var e,h,o,n,a,s,r,p,l,c,g;if(this.built&&this.cropped&&I)return t.isPlainObject(i)||(i={}),g=this.getData(),e=g.width,h=g.height,p=e/h,t.isPlainObject(i)&&(a=i.width,s=i.height,a?(s=a/p,r=a/e):s&&(a=s*p,r=s/h)),o=a||e,n=s||h,l=t("<canvas>")[0],l.width=o,l.height=n,c=l.getContext("2d"),i.fillColor&&(c.fillStyle=i.fillColor,c.fillRect(0,0,o,n)),c.drawImage.apply(c,function(){var t,i,o,n,a,s,p=d(this.$clone[0],this.image),l=p.width,c=p.height,u=[p],f=g.x,m=g.y;return-e>=f||f>l?f=t=o=a=0:0>=f?(o=-f,f=0,t=a=A(l,e+f)):l>=f&&(o=0,t=a=A(e,l-f)),0>=t||-h>=m||m>c?m=i=n=s=0:0>=m?(n=-m,m=0,i=s=A(c,h+m)):c>=m&&(n=0,i=s=A(h,c-m)),u.push(f,m,t,i),r&&(o*=r,n*=r,a*=r,s*=r),a>0&&s>0&&u.push(o,n,a,s),u}.call(this)),l},setAspectRatio:function(t){var i=this.options;this.disabled||e(t)||(i.aspectRatio=Z(t)||0/0,this.built&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,h=this.options;this.ready&&!this.disabled&&(i=h.dragCrop&&"crop"===t,e=h.movable&&"move"===t,t=i||e?t:"none",this.$dragBox.data("drag",t).toggleClass(y,i).toggleClass(C,e),h.cropBoxMovable||this.$face.data("drag",t).toggleClass(y,i).toggleClass(C,e))}}),_.change=function(t){var i,e=this.dragType,h=this.options,o=this.canvas,n=this.container,a=this.cropBox,s=a.width,r=a.height,d=a.left,p=a.top,l=d+s,c=p+r,g=0,u=0,f=n.width,m=n.height,v=!0,w=h.aspectRatio,b={x:this.endX-this.startX,y:this.endY-this.startY};switch(!w&&t&&(w=s&&r?s/r:1),h.strict&&(g=a.minLeft,u=a.minTop,f=g+A(n.width,o.width),m=u+A(n.height,o.height)),w&&(b.X=b.y*w,b.Y=b.x/w),e){case"all":d+=b.x,p+=b.y;break;case"e":if(b.x>=0&&(l>=f||w&&(u>=p||c>=m))){v=!1;break}s+=b.x,w&&(r=s/w,p-=b.Y/2),0>s&&(e="w",s=0);break;case"n":if(b.y<=0&&(u>=p||w&&(g>=d||l>=f))){v=!1;break}r-=b.y,p+=b.y,w&&(s=r*w,d+=b.X/2),0>r&&(e="s",r=0);break;case"w":if(b.x<=0&&(g>=d||w&&(u>=p||c>=m))){v=!1;break}s-=b.x,d+=b.x,w&&(r=s/w,p+=b.Y/2),0>s&&(e="e",s=0);break;case"s":if(b.y>=0&&(c>=m||w&&(g>=d||l>=f))){v=!1;break}r+=b.y,w&&(s=r*w,d-=b.X/2),0>r&&(e="n",r=0);break;case"ne":if(w){if(b.y<=0&&(u>=p||l>=f)){v=!1;break}r-=b.y,p+=b.y,s=r*w}else b.x>=0?f>l?s+=b.x:b.y<=0&&u>=p&&(v=!1):s+=b.x,b.y<=0?p>u&&(r-=b.y,p+=b.y):(r-=b.y,p+=b.y);0>s&&0>r?(e="sw",r=0,s=0):0>s?(e="nw",s=0):0>r&&(e="se",r=0);break;case"nw":if(w){if(b.y<=0&&(u>=p||g>=d)){v=!1;break}r-=b.y,p+=b.y,s=r*w,d+=b.X}else b.x<=0?d>g?(s-=b.x,d+=b.x):b.y<=0&&u>=p&&(v=!1):(s-=b.x,d+=b.x),b.y<=0?p>u&&(r-=b.y,p+=b.y):(r-=b.y,p+=b.y);0>s&&0>r?(e="se",r=0,s=0):0>s?(e="ne",s=0):0>r&&(e="sw",r=0);break;case"sw":if(w){if(b.x<=0&&(g>=d||c>=m)){v=!1;break}s-=b.x,d+=b.x,r=s/w}else b.x<=0?d>g?(s-=b.x,d+=b.x):b.y>=0&&c>=m&&(v=!1):(s-=b.x,d+=b.x),b.y>=0?m>c&&(r+=b.y):r+=b.y;0>s&&0>r?(e="ne",r=0,s=0):0>s?(e="se",s=0):0>r&&(e="nw",r=0);break;case"se":if(w){if(b.x>=0&&(l>=f||c>=m)){v=!1;break}s+=b.x,r=s/w}else b.x>=0?f>l?s+=b.x:b.y>=0&&c>=m&&(v=!1):s+=b.x,b.y>=0?m>c&&(r+=b.y):r+=b.y;0>s&&0>r?(e="nw",r=0,s=0):0>s?(e="sw",s=0):0>r&&(e="ne",r=0);break;case"move":o.left+=b.x,o.top+=b.y,this.renderCanvas(!0),v=!1;break;case"zoom":this.zoom(function(t,i,e,h){var o=O(t*t+i*i),n=O(e*e+h*h);return(n-o)/o}(U(this.startX-this.startX2),U(this.startY-this.startY2),U(this.endX-this.endX2),U(this.endY-this.endY2))),this.startX2=this.endX2,this.startY2=this.endY2,v=!1;break;case"crop":b.x&&b.y&&(i=this.$cropper.offset(),d=this.startX-i.left,p=this.startY-i.top,s=a.minWidth,r=a.minHeight,b.x>0?b.y>0?e="se":(e="ne",p-=r):b.y>0?(e="sw",d-=s):(e="nw",d-=s,p-=r),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(x)))}v&&(a.width=s,a.height=r,a.left=d,a.top=p,this.dragType=e,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},t.extend(p.prototype,_),p.DEFAULTS={aspectRatio:0/0,autoCropArea:.8,crop:null,data:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,highlight:!0,background:!0,autoCrop:!0,dragCrop:!0,movable:!0,rotatable:!0,zoomable:!0,touchDragZoom:!0,mouseWheelZoom:!0,cropBoxMovable:!0,cropBoxResizable:!0,doubleClickToggle:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,dragstart:null,dragmove:null,dragend:null,zoomin:null,zoomout:null,change:null},p.setDefaults=function(i){t.extend(p.DEFAULTS,i)},p.TEMPLATE=function(t,i){return i=i.split(","),t.replace(/\d+/g,function(t){return i[t]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-2-9"></0><0 6="5-crop-9"><1 6="5-view-9"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,drag,data,point,cropper,class,line,dashed,box"),p.other=t.fn.cropper,t.fn.cropper=function(i){var o,n=h(arguments,1);return this.each(function(){var e,h=t(this),a=h.data("cropper");a||h.data("cropper",a=new p(this,i)),"string"==typeof i&&t.isFunction(e=a[i])&&(o=e.apply(a,n))}),e(o)?this:o},t.fn.cropper.Constructor=p,t.fn.cropper.setDefaults=p.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=p.other,this}}),function(){"use strict";angular.module("ngCropper",["ng"]).directive("ngCropper",["$q",function(t){function i(i,h){i=i||{};var o=t.when(i);return i.maximize&&(o=e(i,h)),o}function e(t,i){return h(i).then(function(i){return t.data=i,t})}function h(i){var e=t.defer(),h=new Image;return h.onload=function(){e.resolve({width:h.width,height:h.height})},h.src=i.src,e.promise}return{restrict:"A",scope:{options:"=ngCropperOptions",showEvent:"=ngCropperShow",hideEvent:"=ngCropperHide"},link:function(t,e){var h=!1;t.$on(t.showEvent,function(){h||(h=!0,i(t.options,e[0]).then(function(t){e.cropper(t)}))}),t.$on(t.hideEvent,function(){h&&(h=!1,e.cropper("destroy"))}),t.$watch("options.disabled",function(t){h&&(t&&e.cropper("disable"),t||e.cropper("enable"))})}}}]).service("Cropper",["$q",function(t){function i(i){var e=t.defer(),h=new Image;return h.onload=function(t){e.resolve(t.target)},h.src=i,e.promise}function e(t){var i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.style.display="none",document.body.appendChild(i),i}function h(t){t.parentElement.removeChild(t)}this.encode=function(i){var e=t.defer(),h=new FileReader;return h.onload=function(t){e.resolve(t.target.result)},h.readAsDataURL(i),e.promise},this.decode=function(t){for(var i=t.split(";")[0],e=i.split(":")[1],h=atob(t.split(",")[1]),o=new Uint8Array(h.length),n=0;n<h.length;n++)o[n]=h.charCodeAt(n);return new Blob([o],{type:e})},this.crop=function(t,o){var n=this.decode;return this.encode(t).then(i).then(function(i){var a=e(o),s=a.getContext("2d");s.drawImage(i,o.x,o.y,o.width,o.height,0,0,o.width,o.height);var r=a.toDataURL(t.type);return h(a),n(r)})},this.scale=function(t,o){var n=this.decode;return this.encode(t).then(i).then(function(i){var a,s,r,d=i.height,p=i.width;angular.isNumber(o)&&(a=o,s=d*a,r=p*a),angular.isObject(o)&&(a=p/d,s=o.height,r=o.width,s&&!r?r=s*a:r&&!s&&(s=r/a));var l=e(o),c=l.getContext("2d");l.height=s,l.width=r,c.drawImage(i,0,0,p,d,0,0,r,s);var g=l.toDataURL(t.type);return h(l),n(g)})}}])}();
